<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Valley-Wide Health Systems Brick Fundraising</title>
    <!-- Load Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles */
        body {
            font-family: 'Inter', sans-serif;
        }
        .form-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background-color: #f9fafb; /* gray-50 */
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* shadow-lg */
        }
        .brick-option {
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        .brick-option input:checked + label {
            border-color: #3b82f6; /* blue-500 */
            background-color: #eff6ff; /* blue-50 */
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
        .engraving-line {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        .engraving-line input {
            flex-grow: 1;
            border-radius: 0.375rem; /* rounded-md */
            border: 1px solid #d1d5db; /* gray-300 */
            padding: 0.5rem 0.75rem;
            font-family: 'Courier New', Courier, monospace;
            text-transform: uppercase;
        }
        .engraving-line .char-count {
            margin-left: 0.75rem;
            font-size: 0.875rem; /* text-sm */
            color: #6b7280; /* gray-500 */
            width: 60px; /* Fixed width for alignment */
            text-align: right;
        }
        .clipart-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 1rem;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e5e7eb; /* gray-200 */
            padding: 1rem;
            border-radius: 0.5rem; /* rounded-lg */
        }
        .clipart-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 2px solid #e5e7eb; /* gray-200 */
            border-radius: 0.5rem; /* rounded-lg */
            padding: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            height: 100px;
            background-color: #ffffff;
        }
        .clipart-item:hover, .clipart-item.selected {
            border-color: #3b82f6; /* blue-500 */
            background-color: #eff6ff; /* blue-50 */
        }
        .clipart-item img {
            width: 50px;
            height: 50px;
            object-fit: contain;
        }
        .clipart-item span {
            font-size: 0.75rem; /* text-xs */
            font-weight: 600; /* font-semibold */
            margin-top: 0.5rem;
            color: #4b5563; /* gray-600 */
        }
        /* Simple Modal for messages */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 50;
        }
        .modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 400px;
            text-align: center;
        }
        #brick-canvas {
            background-color: #b95c40; /* Brick color */
            border-radius: 0.5rem;
            border: 2px solid #8a4a30; /* Darker border */
            max-width: 100%;
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="form-container">
        <!-- Header --><div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">Donate to Valley-Wide Health Systems Brick Fundraising Campaign</h1>
            <!-- Updated Logo --><img src="https://valley-widehealth.org/wp-content/uploads/2020/10/VWHS_5inchWIDE_SolidBlue_TransparentBG.png" alt="Valley-Wide Health Systems Logo" class="mx-auto my-4 h-24" 
                 onerror="this.style.display='none'"> <!-- Hide image if it fails to load --><p class="text-lg text-gray-700 leading-relaxed">
                Valley-Wide Health Systems, Inc. will renovate the historic former courthouse at 702 4th Street in Alamosa, Colorado, to co-locate primary and behavioral health services, Physical Therapy, Substance Use Disorder (SUD) treatment, peer support specialists, and to provide daytime respite services for San Luis Valley (SLV) residents.
            </p>
            <p class="text-md text-gray-600 mt-4">
                For questions or concerns, please contact Brooke Trujillo at <a href="mailto:TrujilloB@valley-widehealth.org" class="text-blue-600 hover:underline">TrujilloB@valley-widehealth.org</a> or call <a href="tel:719-992-8767" class="text-blue-600 hover:underline">719-992-8767</a>
            </p>
        </div>

        <!-- Main Form --><form id="brickForm">
            <!-- Step 1: Brick Options --><fieldset class="mb-6">
                <legend class="text-xl font-semibold text-gray-700 mb-4">1. Choose Your Brick Option</legend>
                <div class="space-y-4">
                    <!-- Option 1: 4x8" Text Only --><div class="brick-option rounded-lg">
                        <input type="radio" name="brick_option" id="brick_4x8_text" value="100" class="sr-only" data-lines="3" data-chars="20" data-logo="false" required>
                        <label for="brick_4x8_text" class="block p-6 rounded-lg border-2 border-gray-200 hover:border-blue-400 cursor-pointer">
                            <div class="flex justify-between items-center">
                                <span class="text-lg font-bold text-gray-800">4" x 8" (Text Only)</span>
                                <span class="text-xl font-bold text-blue-600">$100.00</span>
                            </div>
                            <p class="text-gray-600 mt-2">Up to 3 lines of 20 characters per line.</p>
                        </label>
                    </div>

                    <!-- Option 2: 4x8" with Clip Art --><div class="brick-option rounded-lg">
                        <input type="radio" name="brick_option" id="brick_4x8_logo" value="115" class="sr-only" data-lines="1" data-chars="20" data-logo="true">
                        <label for="brick_4x8_logo" class="block p-6 rounded-lg border-2 border-gray-200 hover:border-blue-400 cursor-pointer">
                            <div class="flex justify-between items-center">
                                <span class="text-lg font-bold text-gray-800">4" x 8" (with Clip Art)</span>
                                <span class="text-xl font-bold text-blue-600">$115.00</span>
                            </div>
                            <p class="text-gray-600 mt-2">Includes clip art & 1 line of 20 characters.</p>
                        </label>
                    </div>

                    <!-- Option 3: 8x8" Text Only --><div class="brick-option rounded-lg">
                        <input type="radio" name="brick_option" id="brick_8x8_text" value="250" class="sr-only" data-lines="8" data-chars="20" data-logo="false">
                        <label for="brick_8x8_text" class="block p-6 rounded-lg border-2 border-gray-200 hover:border-blue-400 cursor-pointer">
                            <div class="flex justify-between items-center">
                                <span class="text-lg font-bold text-gray-800">8" x 8" (Text Only)</span>
                                <span class="text-xl font-bold text-blue-600">$250.00</span>
                            </div>
                            <p class="text-gray-600 mt-2">Up to 8 lines of 20 characters per line.</p>
                        </label>
                    </div>

                    <!-- Option 4: 8x8" with Clip Art --><div class="brick-option rounded-lg">
                        <input type="radio" name="brick_option" id="brick_8x8_logo" value="250" class="sr-only" data-lines="6" data-chars="20" data-logo="true">
                        <label for="brick_8x8_logo" class="block p-6 rounded-lg border-2 border-gray-200 hover:border-blue-400 cursor-pointer">
                            <div class="flex justify-between items-center">
                                <span class="text-lg font-bold text-gray-800">8" x 8" (with Clip Art)</span>
                                <span class="text-xl font-bold text-blue-600">$250.00</span>
                            </div>
                            <p class="text-gray-600 mt-2">Includes clip art & up to 6 lines of 20 characters.</p>
                        </label>
                    </div>

                    <!-- Option 5: 12x12" Text Only --><div class="brick-option rounded-lg">
                        <input type="radio" name="brick_option" id="brick_12x12_text" value="500" class="sr-only" data-lines="10" data-chars="25" data-logo="false">
                        <label for="brick_12x12_text" class="block p-6 rounded-lg border-2 border-gray-200 hover:border-blue-400 cursor-pointer">
                            <div class="flex justify-between items-center">
                                <span class="text-lg font-bold text-gray-800">12" x 12" (Text Only)</span>
                                <span class="text-xl font-bold text-blue-600">$500.00</span>
                            </div>
                            <p class="text-gray-600 mt-2">Up to 10 lines of 25 characters per line.</p>
                        </label>
                    </div>

                    <!-- Option 6: 12x12" with Clip Art --><div class="brick-option rounded-lg">
                        <input type="radio" name="brick_option" id="brick_12x12_logo" value="500" class="sr-only" data-lines="8" data-chars="25" data-logo="true">
                        <label for="brick_12x12_logo" class="block p-6 rounded-lg border-2 border-gray-200 hover:border-blue-400 cursor-pointer">
                            <div class="flex justify-between items-center">
                                <span class="text-lg font-bold text-gray-800">12" x 12" (with Clip Art)</span>
                                <span class="text-xl font-bold text-blue-600">$500.00</span>
                            </div>
                            <p class="text-gray-600 mt-2">Includes clip art & up to 8 lines of 25 characters.</p>
                        </label>
                    </div>
                </div>
            </fieldset>

            <!-- Step 2: Engraving Text --><fieldset class="mb-6">
                <legend class="text-xl font-semibold text-gray-700 mb-4">2. Enter Your Engraving Text</legend>
                <p class="text-gray-600 mb-4">Please select a brick option above to see the engraving lines. All text will be centered.</p>
                <div id="engraving-lines-container" class="space-y-2">
                    <!-- JavaScript will populate this --></div>
            </fieldset>

            <!-- Step 3: Brick Preview --><fieldset class="mb-6">
                <legend class="text-xl font-semibold text-gray-700 mb-4">3. Brick Preview</legend>
                <div id="preview-container" class="flex justify-center p-4 bg-gray-200 rounded-lg">
                    <canvas id="brick-canvas" width="400" height="200"></canvas>
                </div>
            </fieldset>

            <!-- Step 4: Clip Art (Conditional) --><fieldset id="clipart-section" class="mb-6 hidden">
                <legend class="text-xl font-semibold text-gray-700 mb-4">4. Choose Clip Art</legend>
                <p class="text-gray-600 mb-2">Click on an image below to select it for your brick. Click again to deselect.</p>
                <input type="hidden" id="selected-clipart" name="selected_clipart">
                
                <!-- Placeholder for Clipart Gallery --><div class="clipart-gallery bg-white p-4 rounded-lg border border-gray-200">
                    <!-- Clip art items would be dynamically loaded, but we'll create a few static examples --><div class="clipart-item" data-clipart-code="A50">
                        <img src="https://polarengraving.com/valleywidehealthsystems/img/clipart/A50.png" alt="Clip Art A50" 
                             onerror="this.onerror=null; this.src='https://placehold.co/50x50/eee/777?text=A50';">
                        <span>A50</span>
                    </div>
                    <div class="clipart-item" data-clipart-code="A51">
                        <img src="https://polarengraving.com/valleywidehealthsystems/img/clipart/A51.png" alt="Clip Art A51" 
                             onerror="this.onerror=null; this.src='https://placehold.co/50x50/eee/777?text=A51';">
                        <span>A51</span>
                    </div>
                    <div class="clipart-item" data-clipart-code="A52">
                        <img src="https://polarengraving.com/valleywidehealthsystems/img/clipart/A52.png" alt="Clip Art A52" 
                             onerror="this.onerror=null; this.src='https://placehold.co/50x50/eee/777?text=A52';">
                        <span>A52</span>
                    </div>
                    <div class="clipart-item" data-clipart-code="B17">
                        <img src="https://polarengraving.com/valleywidehealthsystems/img/clipart/B17.png" alt="Clip Art B17" 
                             onerror="this.onerror=null; this.src='https://placehold.co/50x50/eee/777?text=B17';">
                        <span>B17</span>
                    </div>
                    <div class="clipart-item" data-clipart-code="N01">
                        <img src="https://polarengraving.com/valleywidehealthsystems/img/clipart/N01.png" alt="Clip Art N01" 
                             onerror="this.onerror=null; this.src='https://placehold.co/50x50/eee/777?text=N01';">
                        <span>N01</span>
                    </div>
                    <div class="clipart-item" data-clipart-code="R100">
                        <img src="https://polarengraving.com/valleywidehealthsystems/img/clipart/R100.png" alt="Clip Art R100" 
                             onerror="this.onerror=null; this.src='https://placehold.co/50x50/eee/777?text=R100';">
                        <span>R100</span>
                    </div>
                    <!-- Add more clipart items as needed... --></div>
                
                <div id="logo-upload-section" class="mt-4">
                    <p class="text-gray-600 mb-2">Or upload your own logo. A one-time $50.00 setup fee will be added. We will contact you if your logo is not usable.</p>
                    <input type="file" id="logo_upload" name="logo_upload" class="block w-full text-sm text-gray-500
                        file:mr-4 file:py-2 file:px-4
                        file:rounded-full file:border-0
                        file:text-sm file:font-semibold
                        file:bg-blue-50 file:text-blue-700
                        hover:file:bg-blue-100
                    ">
                </div>
            </fieldset>

            <!-- Step 4: Donor Information --><fieldset class="mb-6 hidden">
                <legend class="text-xl font-semibold text-gray-700 mb-4">4. Your Information</legend>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="donor_name" class="block text-sm font-medium text-gray-700 mb-1">Name *</label>
                        <input type="text" id="donor_name" name="donor_name" class="w-full rounded-md border-gray-300 shadow-sm" required>
                    </div>
                    <div>
                        <label for="donor_email" class="block text-sm font-medium text-gray-700 mb-1">Email *</a.g></label>
                        <input type="email" id="donor_email" name="donor_email" class="w-full rounded-md border-gray-300 shadow-sm" required>
                    </div>
                    <div>
                        <label for="donor_phone" class="block text-sm font-medium text-gray-700 mb-1">Phone *</label>
                        <input type="tel" id="donor_phone" name="donor_phone" class="w-full rounded-md border-gray-300 shadow-sm" required>
                    </div>
                    <div>
                        <label for="donor_address" class="block text-sm font-medium text-gray-700 mb-1">Address *</label>
                        <input type="text" id="donor_address" name="donor_address" class="w-full rounded-md border-gray-300 shadow-sm" required>
                    </div>
                    <div>
                        <label for="donor_city" class="block text-sm font-medium text-gray-700 mb-1">City *</label>
                        <input type="text" id="donor_city" name="donor_city" class="w-full rounded-md border-gray-300 shadow-sm" required>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="donor_state" class="block text-sm font-medium text-gray-700 mb-1">State *</label>
                            <input type="text" id="donor_state" name="donor_state" class="w-full rounded-md border-gray-300 shadow-sm" required>
                        </div>
                        <div>
                            <label for="donor_zip" class="block text-sm font-medium text-gray-700 mb-1">Zip *</label>
                            <input type="text" id="donor_zip" name="donor_zip" class="w-full rounded-md border-gray-300 shadow-sm" required>
                        </div>
                    </div>
                </div>
            </fieldset>

            <!-- Submission --><div class="text-center">
                <button type="button" id="clearPreviewButton" class="bg-gray-500 text-white font-bold py-3 px-10 rounded-lg shadow-md hover:bg-gray-600 transition-colors duration-300 text-lg">
                    Clear Preview
                </button>
            </div>
        </form>
    </div>

    <!-- Simple Modal for Confirmation/Error --><div id="messageModal" class="modal-overlay">
        <div class="modal-content">
            <h3 id="modalTitle" class="text-xl font-semibold mb-4">Message</h3>
            <p id="modalMessage" class="mb-6"></p>
            <button id="modalClose" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700">
                Close
            </button>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const brickOptions = document.querySelectorAll('input[name="brick_option"]');
            const engravingContainer = document.getElementById('engraving-lines-container');
            const clipartSection = document.getElementById('clipart-section');
            const logoUploadSection = document.getElementById('logo-upload-section');
            const clipartItems = document.querySelectorAll('.clipart-item');
            const selectedClipartInput = document.getElementById('selected-clipart');
            const logoUploadInput = document.getElementById('logo_upload');
            const form = document.getElementById('brickForm');
            const messageModal = document.getElementById('messageModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalMessage = document.getElementById('modalMessage');
            const modalClose = document.getElementById('modalClose');
            
            const canvas = document.getElementById('brick-canvas');
            const ctx = canvas.getContext('2d');
            // Default to 4x8 Text Only properties for initial load
            let currentBrickProps = { lines: 3, chars: 20, logo: false, width: 400, height: 200 }; 
            let uploadedLogoImg = null;

            let maxChars = 20;

            // Function to show modal
            function showModal(title, message) {
                modalTitle.textContent = title;
                modalMessage.textContent = message;
                messageModal.classList.add('visible');
            }

            // Function to hide modal
            function hideModal() {
                messageModal.classList.remove('visible');
            }

            modalClose.addEventListener('click', hideModal);
            messageModal.addEventListener('click', (e) => {
                if (e.target === messageModal) {
                    hideModal();
                }
            });

            // Function to update engraving lines
            function updateEngravingLines(numLines, charLimit) {
                engravingContainer.innerHTML = '';
                maxChars = charLimit;
                for (let i = 1; i <= numLines; i++) {
                    const lineDiv = document.createElement('div');
                    lineDiv.className = 'engraving-line';
                    
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.name = `engraving_line_${i}`;
                    input.id = `engraving_line_${i}`;
                    input.maxLength = maxChars;
                    input.dataset.line = i;
                    input.setAttribute('aria-label', `Engraving Line ${i}`);
                    
                    const charCount = document.createElement('span');
                    charCount.className = 'char-count';
                    charCount.textContent = `0 / ${maxChars}`;
                    
                    input.addEventListener('input', (e) => {
                        e.target.value = e.target.value.toUpperCase();
                        charCount.textContent = `${e.target.value.length} / ${maxChars}`;
                        drawBrickPreview(); // Update preview on text input
                    });
                    
                    lineDiv.appendChild(input);
                    lineDiv.appendChild(charCount);
                    engravingContainer.appendChild(lineDiv);
                }
            }

            // Function to draw the brick preview
            function drawBrickPreview() {
                // Clear canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // Draw brick background
                ctx.fillStyle = '#b95c40'; // Brick color
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Set text properties
                // Adjusted font size scaling based on the number of characters and lines
                let calculatedFontSize;
                if (currentBrickProps.logo && currentBrickProps.lines === 1) { // Special case for 4x8 with logo
                    calculatedFontSize = canvas.width / (currentBrickProps.chars + 2) * 1.5; // Larger font for single line
                } else if (currentBrickProps.chars === 25) { // For 12x12 bricks
                    calculatedFontSize = canvas.width / (currentBrickProps.chars + 5);
                } else { // For 4x8 and 8x8 bricks
                    calculatedFontSize = canvas.width / (currentBrickProps.chars + 2);
                }
                
                ctx.fillStyle = '#FFFFFF'; // Engraving color
                ctx.font = `bold ${calculatedFontSize}px 'Courier New', Courier, monospace`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';

                const lines = Array.from(engravingContainer.querySelectorAll('input')).map(input => input.value);
                const numLines = currentBrickProps.lines;
                const hasLogo = currentBrickProps.logo;

                if (hasLogo) {
                    let logoDrawn = false;
                    const logoSize = canvas.width * 0.4; // Logo size relative to canvas
                    const logoX = (canvas.width / 2);
                    let logoY;

                    // Adjust logo Y position based on brick size and number of text lines
                    if (currentBrickProps.height === 200) { // 4x8 brick
                         logoY = canvas.height * 0.35; // Higher for 4x8
                    } else { // 8x8 or 12x12 brick
                        logoY = canvas.height * 0.3; // Default for square bricks
                    }
                    
                    // Try to draw uploaded logo first
                    if (uploadedLogoImg) {
                        ctx.drawImage(uploadedLogoImg, logoX - logoSize / 2, logoY - logoSize / 2, logoSize, logoSize);
                        logoDrawn = true;
                    } 
                    // Else, try to draw selected clipart
                    else if (selectedClipartInput.value) {
                        const selectedClipartItem = document.querySelector(`.clipart-item[data-clipart-code="${selectedClipartInput.value}"] img`);
                        if (selectedClipartItem && selectedClipartItem.complete) {
                            ctx.drawImage(selectedClipartItem, logoX - logoSize / 2, logoY - logoSize / 2, logoSize, logoSize);
                            logoDrawn = true;
                        } else if (selectedClipartItem) {
                            // If image not loaded yet, try again
                            selectedClipartItem.onload = drawBrickPreview;
                        }
                    }

                    // If no logo is drawn, draw a placeholder
                    if (!logoDrawn) {
                        ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
                        ctx.lineWidth = 2;
                        ctx.strokeRect(logoX - logoSize / 2, logoY - logoSize / 2, logoSize, logoSize);
                        ctx.font = `${calculatedFontSize * 0.8}px 'Courier New', Courier, monospace`;
                        ctx.fillText('LOGO', logoX, logoY);
                        ctx.font = `bold ${calculatedFontSize}px 'Courier New', Courier, monospace`; // Reset font
                    }
                    
                    // Draw text lines below logo
                    let textStartY;
                    if (currentBrickProps.height === 200) { // 4x8 brick
                        textStartY = canvas.height * 0.6; // Text closer to bottom for 4x8
                    } else { // 8x8 or 12x12 brick
                        textStartY = canvas.height * 0.65; // Default for square bricks
                    }

                    const lineHeight = (canvas.height - textStartY) / (numLines + 1);
                    
                    lines.forEach((line, index) => {
                        const y = textStartY + (lineHeight * (index + 1));
                        ctx.fillText(line.toUpperCase(), canvas.width / 2, y);
                    });

                } else {
                    // Draw text lines (no logo)
                    const lineHeight = canvas.height / (numLines + 1);
                    lines.forEach((line, index) => {
                        const y = lineHeight * (index + 1);
                        ctx.fillText(line.toUpperCase(), canvas.width / 2, y);
                    });
                }
            }


            // Event listener for brick options
            brickOptions.forEach(option => {
                option.addEventListener('change', (e) => {
                    const selected = e.target;
                    const numLines = parseInt(selected.dataset.lines, 10);
                    const charLimit = parseInt(selected.dataset.chars, 10);
                    const hasLogo = selected.dataset.logo === 'true';

                    let previewWidth = 400; // Base width
                    let previewHeight;

                    if (selected.id.includes('4x8')) {
                        previewHeight = 200; // 4x8 aspect ratio (400x200)
                    } else if (selected.id.includes('8x8') || selected.id.includes('12x12')) {
                        previewHeight = 400; // Square aspect ratio (400x400)
                    }

                    // Update canvas size
                    currentBrickProps = {
                        lines: numLines,
                        chars: charLimit,
                        logo: hasLogo,
                        width: previewWidth,
                        height: previewHeight 
                    };
                    
                    canvas.width = currentBrickProps.width;
                    canvas.height = currentBrickProps.height;

                    updateEngravingLines(numLines, charLimit);
                    
                    if (hasLogo) {
                        clipartSection.classList.remove('hidden');
                    } else {
                        clipartSection.classList.add('hidden');
                        // Clear clipart/logo selection if non-logo brick is chosen
                        selectedClipartInput.value = '';
                        logoUploadInput.value = ''; // Clear file input
                        clipartItems.forEach(item => item.classList.remove('selected'));
                        uploadedLogoImg = null; // Clear uploaded logo image
                    }
                    drawBrickPreview(); // Draw initial preview
                });
            });

            // Event listener for clipart selection
            clipartItems.forEach(item => {
                item.addEventListener('click', () => {
                    const code = item.dataset.clipartCode;
                    
                    // Deselect if already selected
                    if (item.classList.contains('selected')) {
                        item.classList.remove('selected');
                        selectedClipartInput.value = '';
                    } else {
                        // Remove selection from others
                        clipartItems.forEach(other => other.classList.remove('selected'));
                        
                        // Select this one
                        item.classList.add('selected');
                        selectedClipartInput.value = code;
                        
                        // Clear file upload if clipart is selected
                        logoUploadInput.value = '';
                        uploadedLogoImg = null;
                    }
                    drawBrickPreview(); // Update preview
                });
            });

            // Clear clipart selection if logo is uploaded
            logoUploadInput.addEventListener('change', () => {
                if (logoUploadInput.files.length > 0) {
                    clipartItems.forEach(item => item.classList.remove('selected'));
                    selectedClipartInput.value = '';

                    // Read and draw uploaded logo
                    const file = logoUploadInput.files[0];
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const img = new Image();
                        img.onload = () => {
                            uploadedLogoImg = img;
                            drawBrickPreview();
                        }
                        img.onerror = () => {
                            uploadedLogoImg = null;
                            showModal('Error', 'Could not load image file.');
                            drawBrickPreview();
                        }
                        img.src = e.target.result;
                    }
                    reader.onerror = () => {
                        uploadedLogoImg = null;
                        showModal('Error', 'Could not read file.');
                        drawBrickPreview();
                    }
                    reader.readAsDataURL(file);
                } else {
                    uploadedLogoImg = null;
                    drawBrickPreview();
                }
            });

            // Clear Preview Button
            const clearPreviewButton = document.getElementById('clearPreviewButton');
            clearPreviewButton.addEventListener('click', () => {
                // Reset the form fields
                form.reset();
                
                // Clear engraving lines
                engravingContainer.innerHTML = '';
                
                // Hide clipart section
                clipartSection.classList.add('hidden');
                
                // Reset clipart/logo selections
                clipartItems.forEach(item => item.classList.remove('selected'));
                selectedClipartInput.value = '';
                logoUploadInput.value = '';
                uploadedLogoImg = null;
                
                // Reset canvas to a default (e.g., 4x8 text only)
                const defaultOption = document.getElementById('brick_4x8_text');
                if (defaultOption) {
                    defaultOption.checked = true;
                    // Manually trigger change to update state
                    const event = new Event('change');
                    defaultOption.dispatchEvent(event);
                } else {
                    // Fallback if default option not found
                    currentBrickProps = { lines: 3, chars: 20, logo: false, width: 400, height: 200 };
                    canvas.width = currentBrickProps.width;
                    canvas.height = currentBrickProps.height;
                    updateEngravingLines(currentBrickProps.lines, currentBrickProps.chars); // Re-create empty lines
                    drawBrickPreview(); // Draw empty preview
                }
            });

            // Set default selected brick and draw initial preview
            const initialDefaultBrick = document.getElementById('brick_4x8_text');
            if (initialDefaultBrick) {
                initialDefaultBrick.checked = true;
                const event = new Event('change');
                initialDefaultBrick.dispatchEvent(event);
            } else {
                 // Fallback if default option not found or on initial load before any selection
                drawBrickPreview();
            }
        });
    </script>
</body>
</html>
